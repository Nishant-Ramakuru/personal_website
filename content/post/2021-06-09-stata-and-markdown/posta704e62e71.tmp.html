<p>Frequently when I am working in Stata, I find myself wanting to avail myself of the capabilities inherent in R Markdown. I like to be able to intersperse code with text and share my notes with other people in an attractive dynamic HTML or PDF document. It is also really helpful from a workflow standpoint to be able to run code snippets in the text editor and to preview the document that I am writing.</p>
<p>At one point, I thought my solution would just abandon Stata entirely for R. But I found that I kept having to go back to Stata for certain types of analysis and, because some of my earlier projects were done in Stata, it just makes sense to keep doing them in Stata.</p>
<p>A few weeks ago, I felt I just couldn’t stand working in Stata’s .do file editor anymore, so I began a quest to figure out how I could best integrate Stata with Markdown in other environments.</p>
<p>Below is are the options I came across. I start with the ones I like best and proceed in descending order from there.</p>
<div id="hydrogen-in-atom" class="section level2" number="0.1">
<h2 number="0.1"><span class="header-section-number">0.1</span> Hydrogen in Atom</h2>
<p>I really love this setup. Atom is such a cool text editor. You can edit almost any language or document type, the color schemes are attractive and the keyboard shortcuts really help with efficiency.</p>
<p>The best thing about Atom is that you can use the <a href="https://atom.io/packages/hydrogen">Hydrogen package</a> to run code interactively. You can even run code for multiple kernels/languages in the <a href="https://blog.nteract.io/hydrogen-introducing-rich-multi-language-documents-b5057ff34efc">same document</a>.</p>
<p>To create an interactive document with Stata, you need to install Kyle Barron’s <a href="https://kylebarron.dev/stata_kernel/">stata_kernel</a> and the <a href="https://atom.io/packages/language-markdown">language-markdown</a>package. <code>stata_kernel</code> is the Jupyter kernel for Stata that allows the code to run interactively while Language Markdown is an Atom package that provides support for Markdown (including R Markdown). I also installed <a href="https://atom.io/packages/markdown-preview-plus">Markdown Preview Plus (MPP)</a>, which provides a live updated preview of your document.</p>
<p>In case you are not familiar with Atom, each Jupyter kernel that you use is going to be installed in a slightly different way. For the <code>stata_kernel</code>, follow the instructions that Kyle Barron provides. You install Atom packages in Atom by hitting <code>ctrl</code> + <code>shift</code> + <code>p</code> in Windows/Linux or <code>cmd</code> + <code>shift</code> + <code>p</code> in macOS.</p>
<p>Once you get everything set up, you should be able to intersperse your code with text and preview the resulting document like this:</p>
<p><img src="C:\media\stata-markdown.gif" /></p>
<p>The only shortcoming here is that you cannot easily export the code along with the text to a shareable HTML or PDF document. For this, you can open your Markdown document in R and use the Statamarkdown package.</p>
</div>
<div id="statamarkdown-in-r" class="section level2" number="0.2">
<h2 number="0.2"><span class="header-section-number">0.2</span> Statamarkdown in R</h2>
<p>With Doub Hemken’s <a href="https://github.com/Hemken/Statamarkdown">Statamarkdown</a>, you can knit your .Rmd or .RMarkdown file in the usual way to create a document like an .html or .pdf or a blog post. There is a nice tutorial on how to use it <a href="https://www.ssc.wisc.edu/~hemken/Stataworkshops/Stata%20and%20R%20Markdown/StataMarkdown.html">here</a>.</p>
<p>At the time I am writing this post, Statamarkdown is good for producing documents but <a href="https://github.com/Hemken/Statamarkdown/issues/12">does not work</a> for running code interactively in a notebook. Also, Statamarkdown does not automatically remember what code you ran from one chunk to the next. In order to run a code chunk sequentially that builds on the previous chunk, you have to enable the <code>collectcode = TRUE</code> option, like this:</p>
<p>First code block:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">generate</span> gpm = 1/mpg</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> price gpm</span></code></pre></div>
<pre><code>    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
       price |         74    6165.257    2949.496       3291      15906
         gpm |         74    .0501928    .0127986   .0243902   .0833333</code></pre>
<p>Second code block:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">regress</span> price gpm</span></code></pre></div>
<pre><code>      Source |       SS           df       MS      Number of obs   =        74
-------------+----------------------------------   F(1, 72)        =     35.95
       Model |   211486574         1   211486574   Prob &gt; F        =    0.0000
    Residual |   423578822        72  5883039.19   R-squared       =    0.3330
-------------+----------------------------------   Adj R-squared   =    0.3238
       Total |   635065396        73  8699525.97   Root MSE        =    2425.5

------------------------------------------------------------------------------
       price | Coefficient  Std. err.      t    P&gt;|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
         gpm |     132990   22180.86     6.00   0.000     88773.24    177206.7
       _cons |  -509.8827   1148.469    -0.44   0.658    -2799.314    1779.548
------------------------------------------------------------------------------</code></pre>
<p>The process creates a bunch of .do and .log files that you have to back and clean up afterwards. Despite these limitations and minor hassles, Statamarkdown does achieve the desired objective of allowing you to use Stata in an R Markdown framework.</p>
</div>
<div id="markstat-in-stata" class="section level2" number="0.3">
<h2 number="0.3"><span class="header-section-number">0.3</span> Markstat in Stata</h2>
<p>Germán Rodriguez’s <a href="https://data.princeton.edu/stata/markdown"><code>markstat</code> command</a> is probably the best option if you want to produce a dynamic document but stay completely in the realm of Stata. With <code>markstat</code> you intersperse Markdown annotations with Stata code like this:</p>
<pre><code># Stata and Markdown

Let&#39;s write some markdown-formatted text and see what happens.

## Run Stata Code

Now let&#39;s try running some Stata code:

  sysuse auto, clear
  summarize mpg weight
  regress mpg weight

## To Do List 

Let&#39;s follow up on it by doing the following:

1. One thing
2. Two thing
3. Red thing
4. Blue thing

Etc.... </code></pre>
<p>The code gets identified with indentations rather than back ticks. You then need to save it as a script (.stmd) file and then process the file by running the <code>markstat</code> command in Stata. You also need to have Pandoc installed.</p>
<p>Markstat definitely produces attractive documents and slides and is a better solution than Statamarkdown in R if that is all you want to do. In my case, I really wanted to be able to include Stata code and results in .RMarkdown files so that I could produce posts like this one.</p>
</div>
<div id="other-solutions" class="section level2" number="0.4">
<h2 number="0.4"><span class="header-section-number">0.4</span> Other Solutions</h2>
<p>There are a few other solutions I looked at but did not end up not using.</p>
<p>Stata is promoting its <a href="https://www.stata.com/python/pystata/install.html"><strong>pystata</strong></a> Python package, which allows you to run Stata in an IPython environment like Jupyter notebooks. There is also Stata’s <a href="https://www.stata.com/manuals/rptdyndoc.pdf"><code>dyndoc</code></a> command, which converts a text file into an HTML file or Word document.</p>
<p>I also tried using <strong>pystata</strong> in conjunction with the <strong>reticulate</strong> package in R, which I definitely do not recommend!</p>
<p>I hope you find a Stata/Markdown solution that works for you. Let me know what you choose and if there is something I missed here.</p>
</div>
